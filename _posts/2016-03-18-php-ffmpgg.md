 ---
layout: post
title: php将视频文件生成缩略图
tags:
- 视频
- 缩略图
- php
- 视频缩略图
description: 视频 缩略图 php 视频缩略图
---
 <div class="bct fc05 fc11 nbw-blog ztag"><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >1.&nbsp;下载&nbsp;ffmpeg-php,&nbsp;ffmpeg-php-5.3-win32-all.zip<br></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >2.&nbsp;将&nbsp;php_ffmpeg.dll&nbsp;放到&nbsp;PHP&nbsp;扩展目录，（例如&nbsp;E:\Program&nbsp;Files\wamp\bin\php\php5.3.5\ext）<br></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >3.&nbsp;将其他的<a style="color: rgb(0, 85, 153); text-decoration: none;" target="_blank" rel="nofollow" href="http://wenwen.soso.com/z/Search.e?sp=Sdll%E6%96%87%E4%BB%B6&amp;ch=w.search.yjjlink&amp;cid=w.search.yjjlink"   >dll文件</a>放到系统目录，（例如&nbsp;C:\Windows\System32）<br></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >4.&nbsp;修改&nbsp;php.ini，添加&nbsp;extension=php_ffmpeg.dll&nbsp;配置项，结果如下：<br></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   ><br>extension=php_gd2.dll<br>extension=php_gettext.dll<br>extension=php_ffmpeg.dll<br><br></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >（<strong>注</strong>：Wamp&nbsp;环境下要修改&nbsp;apache&nbsp;目录中的&nbsp;php.ini,(例如E:\Program&nbsp;Files\wamp\bin\apache\Apache2.2.17\bin\php.ini),&nbsp;同时要启用gd2&nbsp;和&nbsp;gettext&nbsp;模块）<br></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >5.&nbsp;重新启动&nbsp;apache&nbsp;服务器<br></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >6.打印输出&nbsp;phpinfo，查看是否有如下输出，若有，则说明&nbsp;ffmpeg-php&nbsp;模块配置正确<br>ffmpegffmpeg-php&nbsp;version0.6.0-svnffmpeg-php&nbsp;built&nbsp;onSep&nbsp;8&nbsp;2010&nbsp;12:13:47ffmpeg-php&nbsp;gd&nbsp;supportenabledffmpeg&nbsp;libavcodec&nbsp;versionLavc52.87.4ffmpeg&nbsp;libavformat&nbsp;versionLavf52.78.3ffmpeg&nbsp;swscaler&nbsp;versionSwS0.11.0</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >&nbsp;<br>DirectiveLocal&nbsp;ValueMaster&nbsp;Valueffmpeg.allow_persistent00ffmpeg.show_warnings00</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >7.&nbsp;编写测试代码，示例代码截取视频的第二帧为缩略图<br>public&nbsp;function&nbsp;testmp4(){if(extension_loaded('ffmpeg')){//判断ffmpeg是否载入$mov&nbsp;=&nbsp;new&nbsp;ffmpeg_movie('E:\\Program&nbsp;Files\\wamp\\www\\BBShow\\test\\guangfa15s.mp4');//视频的路径</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >dump($mov);</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >$ff_frame&nbsp;=&nbsp;$mov-&gt;getFrame(2);</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >$gd_image&nbsp;=&nbsp;$ff_frame-&gt;toGDImage();</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >$img=$_SERVER['DOCUMENT_ROOT']."/test.jpg";//要生成图片的绝对路径imagejpeg($gd_image,&nbsp;$img);//创建jpg图像imagedestroy($gd_image);//销毁一图像</p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >$imgfile=$img;</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >//生成缩略图开始</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;list($imgw, $imgh, $imgt, $attr) = getimagesize($imgfile);//获取图片信息</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //计算缩小的比例，目标最长边缩至100</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $percent = $imgw&gt;$imgh?(100/$imgw):(100/$imgh); //以最长边作为缩放参考</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; if($percent&lt;1){ //计算缩略图的新尺寸</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $new_width = floor($imgw*$percent);</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $new_height = floor($imgh*$percent);</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }else{ //如果原图尺寸小于 100x100 直接输出原图尺寸</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $new_width = $imgw;</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $new_height = $imgh;</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; }</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $thumb=imagecreatetruecolor($new_width,$new_height); &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //读取图片</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //判断格式，图像类型，但缩略图输出的都是jpg..参考下文</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; $orgimg=imagecreatefromjpeg($imgfile);</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; //imagecopyresampled(缩略图片资源, 源图片资源, dx, dy, sx,sy, 新图像宽度, 新图像高度, 源图像宽度, 源图像高度);</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagecopyresampled($thumb, $orgimg, 0, 0, 0, 0, $new_width, $new_height, $imgw, $imgh); //缩放核心函数 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagejpeg($thumb,$img); //输出图像</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//销毁资源 &nbsp;&nbsp;</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagedestroy($thumb);</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; imagedestroy($orgimg);</font></p><p style="margin-top: 0px; margin-bottom: 0px;"   ><font face="Tahoma, Arial, Helvetica, sans-serif, SimSun"   >//生成缩略图结束</font></p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >}else{</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >echo&nbsp;"ffmpeg没有载入";</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >}</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   >}&nbsp;&nbsp;</p><p style="margin-top: 0px; margin-bottom: 0px; font-family: Tahoma, Arial, Helvetica, sans-serif, SimSun; line-height: 26px;"   ><br></p><wbr></div>